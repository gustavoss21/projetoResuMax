<!doctype html>
<html lang="pt-br">


<head>
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <!-- CSS BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <!-- CSS CUSTOM -->
    <!-- CSS QUILL -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <script src="https://kit.fontawesome.com/4777774bce.js" crossorigin="anonymous"></script>


</head>



<body>
    {% load static %}
    <header>
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container-fluid">
                <div class="navbar-brand">resu<span>max</span></div>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <form class="d-flex justify-content-center" role="search">
                        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn btn-outline-dark" type="submit">Search</button>
                    </form>
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link" href="">Funciona?</a></li>
                        <li class="nav-item"><a class="nav-link" href="">Contate-nos</a></li>
                        <li class="nav-item"><a class="nav-link" href="">Arquivos</a></li>
                        <li class="nav-item"><a class="nav-link" href="">Resumos</a></li>
                    </ul>
                </div>
            </div>
        </nav>

    </header>
    <main class="row">
        <!-- barra lateral esquerda -->
        <div class="col-md-2 barra-lateral-esquerda d-none d-md-block">
            <div class="dropdown" id="bloco-right">
                <button class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown"
                    type="button">opções</button>
                <ul class="dropdown-menu ps-4">
                    <!--barra-folha-->
                    <li class="dropdown-item">tema</li>
                    <li class="dropdown-item">subtema</li>
                    <li class="dropdown-item">topico</li>
                    <li class="dropdown-item">importante</li>
                    <li class="dropdown-item">destaque</li>
                    <li> <button type="button" class="btn btn-light w-75 mb-3" id="btn-leitura"
                            data-bs-toggle="button">Somente
                            Leitura</button>
                    </li>
                    <li>
                        <button type="button" class="btn btn-light w-75 mb-3" onclick="salvar()">salvar</button>
                    </li>
                </ul>
            </div>
            <ol>
                <li>
                    <div class="solo">item 0</div>
                    <ol type="A">
                        <li class="ol">item A</li>
                        <li class="ol">item A</li>
                        <li class="ol">item A</li>
                    </ol>
                </li>
                <li>
                    <div class="solo">item 1</div>
                </li>
                <li>
                    <div class="solo">item 2</div>
                    <ol type="A">
                        <li class="ol">item B</li>
                        <li class="ol">item B</li>
                        <li class="ol">item B</li>
                    </ol>
                </li>
            </ol>
        </div>
        <!-- conteudo central -->
        <div class="border col-md-9 block row">

            <div id="bloco-center">
                {% csrf_token %}
                <div id="editor" class="papelA4">

                    {% for c in artigo%}
                    {{c.conteudo|safe}}
                    {% endfor %}

                </div>
            </div>

        </div>
        <div id="tamanho-folha-edit">
            <input type="range" max="100" min="25" class="form-range" id="customRange1"
                onmouseup="defineTamanhoFolha()">
        </div>
    </main>
    <footer class="m-5"></footer>

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>
    <!-- Include the Quill library -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        var toolbarOptions = [
            [
                'delete', 'bold', 'italic', 'underline', 'strike'
            ], [
                'blockquote', 'code-block'
            ], [
                { 'header': 1 }, { 'header': 2 }
            ], [{ 'list': 'ordered' }, { 'list': 'bullet' }],
            [{ 'script': 'sub' }, { 'script': 'super' }],
            [{ 'direction': 'rtl' }],

            [{ 'size': ['smoll', false, 'large', 'hugo'] }],
            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

            [{ 'color': [] }, { 'background': [] }],
            [{ 'font': [] }],
            [{ 'align:': [] }],
            ['image'],

            ['clean']
        ]

        var quill = new Quill('#editor', {
            modules: {
                toolbar: {
                    container: toolbarOptions,
                    handlers: {
                        image: urlImage
                    }
                }
            },
            theme: 'snow',//bubble
            // placeholder: 'teste'
        })


        function urlImage() {
            let selection = this.quill.getSelection() //pegara a instancia de imagem definido acima
            let prompt = window.prompt('URL da imagem')
            if (prompt === null || prompt == '') { return }
            this.quill.insertEmbed(selection.index, 'image', prompt)//vai inserir a imagem aonde foi selecionado
        }
        // function retorna_html() {
        //     console.log(quill.root.innerHTML)
        //     return quill.root.innerHTML
        // }
        function retorna_html() {
            let folhas = document.querySelectorAll('.ql-editor')
            // folhas = document.querySelectorAll('#editor.ql-container.ql-snow')
            let conteudo = ''
            for (pagina of folhas) {
                conteudo += pagina.innerHTML
            }
            return conteudo
        }


        function salvar() {
            csrf_token = document.querySelector('[name=csrfmiddlewaretoken]').value
            artigo = retorna_html()
            fetch("/salvar/", {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrf_token
                },
                body: JSON.stringify({ 'conteudo': artigo })
            }).then(function (data) {
                return data.json()
            }).then(function (data) {
                location.reload(true)
            })

        }
    </script>
    <script src="{% static 'scripts.js' %}"></script>
    <!-- <script id="hello-data" type="application/json">{{ artigo }}</script> -->
    <!-- <script id="hello-data" type="application/json">{"hello": "world"}</script> -->
</body>

</html>