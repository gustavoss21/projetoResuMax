worker_processes 4;
 
events {
    worker_connections 1024;
 }

http {
    upstream resumax-upstream {
        least_conn;

        server resumax1:8000 weight=10 max_fails=3 fail_timeout=30s;
        server resumax2:8000 weight=10 max_fails=3 fail_timeout=30s;
        server resumax3:8000 weight=10 max_fails=3 fail_timeout=30s;

        keepalive 64;
    }

    # server {
    #     listen 80;
    #     server_name resumax.online;
    #     location / {
    #         return 301 https://$host$request_uri;
    #     }    
    #     location / {
    #     proxy_pass http://resumax.online; 
    #     proxy_pass_header Server;
    #     proxy_set_header X-Forwarded-Host $server_name;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header Host $http_host;
    #     }
    # }

    server {
        isten 80;
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name resumax.online www.resumax.online;

        # ssl_certificate /etc/nginx/ssl/resumax.online/fullchain.pem;
        # ssl_certificate_key /etc/nginx/ssl/resumax.online/privkey.pem;
        # #configuration from ssl
        # ssl_protocols TLSv1.3;# Requires nginx >= 1.13.0 else use TLSv1.2
        # ssl_prefer_server_ciphers on;
        # ssl_ciphers EECDH+AESGCM:EDH+AESGCM;
        # ssl_ecdh_curve secp384r1; # Requires nginx >= 1.1.0
        # ssl_session_timeout  10m;
        # ssl_session_cache shared:SSL:10m;
        # ssl_session_tickets off; # Requires nginx >= 1.5.9
        # ssl_stapling on; # Requires nginx >= 1.3.7
        # ssl_stapling_verify on; # Requires nginx => 1.3.7
        # resolver 8.8.8.8 8.8.4.4 valid=300s;
        # resolver_timeout 5s;
        # add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";
        # add_header X-Frame-Options DENY;
        # add_header X-Content-Type-Options nosniff;
        # add_header X-XSS-Protection "1; mode=block";
                        
        # ssl_dhparam etc/ssl/certs/dhparam.pem;

        location / {
        proxy_pass http://resumax-upstream; 
        proxy_pass_header Server;
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        }

        location /static/ {
            proxy_redirect off;
            autoindex on;
            alias /var/www/staticfiles/;
            expires 1d;
        }

        location /media/ {
            proxy_redirect off;
            autoindex on;
            alias /var/www/media/;
            expires 1d;
        }

    }
}